## Bun vs. Node with Suspense

This is a sample project to compare the usage of Bun and Node with [Suspense](https://react.dev/reference/react/Suspense).

### Running the project
1. Install dependencies with [Bun](https://bun.sh): `bun install`
2. Serve the project with either the Bun or Node server: `bun run serve:bun` or `bun run serve:node`.
3. Open the application at `http://localhost:3000`.

### File overview
Overview of files in `src` directory:
- `Application.jsx`: A sample React app that embeds the `LazyButton` component inside a `Suspense` boundary that resolves after 2 seconds.
- `LazyComponent.jsx`: A lazy-loaded component that is loaded asynchronously with [`lazy()`](https://react.dev/reference/react/lazy).
- `ssr/`
    - `client/entry-client.js`: React hydration script for the client. Hydrates `Application` component.
    - `server/entry-server.jsx`: A JSX component that contains the entire application, including the HTML headers and meta. Embeds `Application` component and includes scripts generated by the clientside build.
    - `server/server.bun.jsx`: A Bun HTTP server that returns the application as a ReadableStream.
    - `server/server.node.jsx`: A Node HTTP server that pipes the application as a PipeableStream to the response.

### The problem
When serving the application with Bun, the server throws the following error on receipt of the first request, only when a `Suspense` boundary is present:
```
8169 |   try {
8170 |     var abortableTasks = request.abortableTasks;
8171 |     if (0 < abortableTasks.size) {
8172 |       var error =
8173 |         void 0 === reason
8174 |           ? Error("The render was aborted by the server without a reason.")
                   ^
error: The render was aborted by the server without a reason.
      at abort (/home/jmuzina/software/work/canonical/repos/react-repro/node_modules/react-dom/cjs/react-dom-server.bun.development.js:8174:13)
      at cancel (/home/jmuzina/software/work/canonical/repos/react-repro/node_modules/react-dom/cjs/react-dom-server.bun.development.js:8262:17)
      at close (3:17)

8169 |   try {
8170 |     var abortableTasks = request.abortableTasks;
8171 |     if (0 < abortableTasks.size) {
8172 |       var error =
8173 |         void 0 === reason
8174 |           ? Error("The render was aborted by the server without a reason.")
                   ^
error: The render was aborted by the server without a reason.
      at abort (/home/jmuzina/software/work/canonical/repos/react-repro/node_modules/react-dom/cjs/react-dom-server.bun.development.js:8174:13)
      at cancel (/home/jmuzina/software/work/canonical/repos/react-repro/node_modules/react-dom/cjs/react-dom-server.bun.development.js:8262:17)
      at close (3:17)
```
Additionally, the `LazyComponent` remains suspended after it is resolved on the server.
The application must be re-rendered to resolve the `Suspense` boundary on the client. This can be seen by clicking the "increment count" button.
Clicking this button while the `LazyComponent` is suspended will cause the `LazyComponent`'s suspense boundary to be evaluated and resolved.